# docker/api/Dockerfile.prod
# Production-ready Dockerfile for the TrafficJamz backend

FROM node:20-alpine

# 📁 Working directory
WORKDIR /app

# 🧰 Install build tools (needed for native modules)
RUN apk add --no-cache \
  python3 \
  py3-pip \
  make \
  g++ \
  linux-headers \
  curl

# 📦 Copy only package manifest for install caching
COPY jamz-server/package*.json ./

# 🔧 Install production dependencies
RUN npm install --omit=dev

# 🚚 Copy source code (only after install for clean cache layers)
COPY jamz-server/src ./src
COPY jamz-server/public ./public
COPY shared ./shared

# 🌱 Runtime environment
ENV NODE_ENV=production

# 🔥 Start the backend server
CMD ["npm", "start"]
