# docker/api/Dockerfile.prod
# Production-ready Dockerfile for the TrafficJamz backend

# â”€â”€â”€ Base Image â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
FROM node:20-alpine

# ğŸ“ Define working directory
WORKDIR /app

# ğŸ§° Install native build tools required for node modules with C bindings
RUN apk add --no-cache \
  python3 \
  py3-pip \
  make \
  g++ \
  linux-headers \
  curl

# ğŸ“¦ Copy only package manifest files to leverage Docker layer caching
COPY jamz-server/package*.json ./

# ğŸ”§ Install production-only dependencies to reduce image size
RUN npm install --omit=dev

# ğŸšš Copy application code and shared logic after dependencies
COPY jamz-server/src ./src
COPY jamz-server/public ./public
COPY shared ./shared

# ğŸŒ± Set runtime environment variable
ENV NODE_ENV=production

# ğŸ”¥ Start the backend server via NPM (can swap for entrypoint if needed)
CMD ["npm", "start"]
