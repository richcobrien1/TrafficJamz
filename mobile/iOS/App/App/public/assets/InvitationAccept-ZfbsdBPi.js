import{h as B,r as m,a as R,u as S,j as e,i as b}from"./index-C_3tyMlA.js";import{B as o,T as r,P as F}from"./Box-B7n4D01-.js";import{C as $,B as h}from"./List-K2ODHGaJ.js";import{A as q}from"./Grow-5OE428Pa.js";import{T as y}from"./TextField-BEOKNznX.js";import"./mergeSlotProps-COfFLBTA.js";const H=()=>{var k,A,w;const{groupId:x,invitationIndex:I}=B(),[a,l]=m.useState("loading"),[g,N]=m.useState(""),[t,E]=m.useState(null),[D,_]=m.useState(null),[i,C]=m.useState({firstName:"",lastName:"",mobilePhone:""}),p=R(),{user:c}=S();m.useEffect(()=>{(async()=>{var s,n;try{l("loading");const f=(await b.get(`/invitations/${x}/${I}`)).data;E(f);try{const j=await b.get(`/users/check-email?email=${f.invitation.email}`);_(j.data.exists),c&&c.email===f.invitation.email&&C({firstName:c.first_name||"",lastName:c.last_name||"",mobilePhone:c.phone_number||""})}catch(j){console.error("Error checking user:",j)}l("show_form")}catch(d){console.error("Error checking invitation:",d),l("error"),N(((n=(s=d.response)==null?void 0:s.data)==null?void 0:n.message)||"Failed to process invitation")}})()},[x,I,p,c]);const v=u=>{const{name:s,value:n}=u.target;C({...i,[s]:n})},P=async()=>{var u,s;try{l("accepting");let n={email:t.invitation.email};a==="show_form"&&(n={...n,firstName:i.firstName,lastName:i.lastName,mobilePhone:i.mobilePhone});const d=await b.post(`/invitations/${t.invitationId}/accept`,n);console.log("Accept response:",d.data),l("success")}catch(n){console.error("Error accepting invitation:",n),l("error"),N(((s=(u=n.response)==null?void 0:u.data)==null?void 0:s.message)||"Failed to accept invitation")}};return a==="loading"||a==="accepting"?e.jsxs(o,{sx:{display:"flex",flexDirection:"column",alignItems:"center",p:4},children:[e.jsx($,{}),e.jsx(r,{variant:"h6",sx:{mt:2},children:a==="loading"?"Processing your invitation...":"Accepting invitation..."})]}):a==="error"?e.jsxs(o,{sx:{display:"flex",flexDirection:"column",alignItems:"center",p:4},children:[e.jsx(r,{variant:"h5",color:"error",children:"Error Processing Invitation"}),e.jsx(r,{variant:"body1",sx:{mt:2},children:g}),e.jsx(h,{variant:"contained",onClick:()=>p("/"),sx:{mt:3},children:"Return to Home"})]}):a==="show_form"?e.jsx(o,{sx:{display:"flex",flexDirection:"column",alignItems:"center",p:4,maxWidth:500,mx:"auto"},children:e.jsxs(F,{sx:{p:3,width:"100%"},children:[e.jsx(r,{variant:"h5",gutterBottom:!0,align:"center",children:"Accept Invitation"}),e.jsxs(r,{variant:"body1",sx:{mb:3},align:"center",children:["You've been invited to join ",e.jsx("strong",{children:(k=t==null?void 0:t.group)==null?void 0:k.name})]}),g&&e.jsx(q,{severity:"error",sx:{mb:2},children:g}),e.jsxs(o,{component:"form",sx:{width:"100%",mt:1},children:[e.jsx(y,{margin:"normal",required:!0,fullWidth:!0,id:"firstName",label:"First Name",name:"firstName",autoComplete:"given-name",value:i.firstName,onChange:v,variant:"outlined"}),e.jsx(y,{margin:"normal",required:!0,fullWidth:!0,id:"lastName",label:"Last Name",name:"lastName",autoComplete:"family-name",value:i.lastName,onChange:v,variant:"outlined"}),e.jsx(y,{margin:"normal",required:!0,fullWidth:!0,id:"mobilePhone",label:"Mobile Phone",name:"mobilePhone",autoComplete:"tel",value:i.mobilePhone,onChange:v,variant:"outlined"}),e.jsxs(o,{sx:{display:"flex",justifyContent:"space-between",mt:3},children:[e.jsx(h,{variant:"outlined",onClick:()=>p("/"),children:"Cancel"}),e.jsx(h,{type:"button",variant:"contained",onClick:P,disabled:!i.firstName||!i.lastName||!i.mobilePhone,children:"Accept Invitation"})]})]})]})}):a==="ready_to_accept"?e.jsxs(o,{sx:{display:"flex",flexDirection:"column",alignItems:"center",p:4},children:[e.jsx(r,{variant:"h5",gutterBottom:!0,children:"Accept Invitation"}),e.jsxs(r,{variant:"body1",sx:{mb:3},children:["You've been invited to join ",e.jsx("strong",{children:(A=t==null?void 0:t.group)==null?void 0:A.name}),". Click the button below to accept the invitation."]}),e.jsx(h,{variant:"contained",color:"primary",onClick:P,size:"large",children:"Accept Invitation"})]}):a==="success"?e.jsxs(o,{sx:{display:"flex",flexDirection:"column",alignItems:"center",p:4},children:[e.jsx(r,{variant:"h5",color:"primary",gutterBottom:!0,children:"Invitation Accepted!"}),e.jsxs(r,{variant:"body1",sx:{mb:3},children:["You have successfully joined the group ",e.jsx("strong",{children:(w=t==null?void 0:t.group)==null?void 0:w.name}),"."]}),e.jsx(h,{variant:"contained",color:"primary",onClick:()=>p(`/groups/${x}`),size:"large",children:"Continue to Group"})]}):null};export{H as default};
