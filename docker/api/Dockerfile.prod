# docker/api/Dockerfile.prod
# Production-ready Dockerfile for the TrafficJamz backend

FROM node:20-alpine

# ğŸ“ Working directory
WORKDIR /app

# ğŸ§° Install build tools (needed for native modules)
RUN apk add --no-cache \
  python3 \
  py3-pip \
  make \
  g++ \
  linux-headers \
  curl

# ğŸ“¦ Copy only package manifest for install caching
COPY jamz-server/package*.json ./

# ğŸ”§ Install production dependencies
RUN npm install --omit=dev

# ğŸšš Copy source code (only after install for clean cache layers)
COPY jamz-server/src ./src
COPY jamz-server/public ./public
COPY shared ./shared

# ğŸŒ± Runtime environment
ENV NODE_ENV=production

# ğŸ”¥ Start the backend server
CMD ["npm", "start"]
