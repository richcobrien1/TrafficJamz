# docker/api/Dockerfile.dev
# Development Dockerfile for the TrafficJamz API service

FROM node:18-alpine

# Set working directory to the monorepo root
WORKDIR /app

# Install system dependencies
RUN apk add --no-cache python3 py3-pip make g++ linux-headers

# Copy workspace-aware package manifests
COPY package*.json ./
COPY backend/package*.json ./backend/
COPY frontend/package*.json ./frontend/

# Install full workspace dependencies
RUN npm install --legacy-peer-deps

# Copy backend and shared code
COPY backend ./backend
COPY shared ./shared

# Set working directory to backend for API launch
WORKDIR /app/backend

# Set environment variables
ENV NODE_ENV=development
ENV IS_LOCAL=true

# Expose dev API port
EXPOSE 5000

# Launch API with hot reload on file change
CMD ["sh", "-c", "npx nodemon --watch src src/api/server.js"]
