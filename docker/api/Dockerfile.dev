# docker/api/Dockerfile.dev
# Dev Dockerfile for TrafficJamz backend with nodemon, debug tools, and live reload

FROM node:20-alpine

# ğŸ—ï¸ Working directory
WORKDIR /app

# ğŸ§° Install dev tools
RUN apk add --no-cache \
  python3 \
  py3-pip \
  make \
  g++ \
  linux-headers \
  curl

# ğŸ“¦ Copy package manifest first for caching
COPY jamz-server/package*.json ./
RUN npm install --legacy-peer-deps

# ğŸ§© Copy source + assets (after deps to preserve cache)
COPY jamz-server/src ./src
COPY jamz-server/public ./public
COPY shared ./shared

# ğŸŒ± Environment flags
ENV NODE_ENV=development
ENV IS_LOCAL=true

# ğŸ”¥ Start server with nodemon for auto-reload
CMD ["npx", "nodemon", "--inspect", "src/index.js"]
