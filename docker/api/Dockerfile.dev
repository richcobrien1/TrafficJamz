# docker/api/Dockerfile.dev
# Dev Dockerfile for TrafficJamz backend with nodemon, debug tools, and live reload

FROM node:20-alpine

# 🏗️ Working directory
WORKDIR /app

# 🧰 Install dev tools
RUN apk add --no-cache \
  python3 \
  py3-pip \
  make \
  g++ \
  linux-headers \
  curl

# 📦 Copy package manifest first for caching
COPY jamz-server/package*.json ./
RUN npm install --legacy-peer-deps

# 🧩 Copy source + assets (after deps to preserve cache)
COPY jamz-server/src ./src
COPY jamz-server/public ./public
COPY shared ./shared

# 🌱 Environment flags
ENV NODE_ENV=development
ENV IS_LOCAL=true

# 🔥 Start server with nodemon for auto-reload
CMD ["npx", "nodemon", "--inspect", "src/index.js"]
