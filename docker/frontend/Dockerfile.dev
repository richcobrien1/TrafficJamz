# Dockerfile for TrafficJamz frontend development environment
# Sets up Node.js + React dev environment with Vite, hot reloading, and system tools for native packages

FROM node:18-alpine

# ğŸ—ï¸ Working directory â€” scoped for frontend clarity
WORKDIR /app/frontend

# ğŸ§° Install system-level build tools (needed by MUI, emotion, etc.)
RUN apk add --no-cache python3 make g++ curl

# ğŸ“¦ Dependency install layer (cached if package.json unchanged)
COPY jamz-client-vite/package*.json ./
RUN npm install --legacy-peer-deps

# ğŸ§  App code + public assets
COPY jamz-client-vite/src ./src
COPY jamz-client-vite/public ./public

# ğŸ§© Shared modules (ensure this path is within your build context)
COPY shared ./shared

# ğŸŒ± Dev-only environment flags
ENV NODE_ENV=development
ENV REACT_APP_API_URL=http://localhost:5000
ENV REACT_APP_WEBRTC_URL=http://localhost:5000

# ğŸ”Š Dev port
EXPOSE 8080

# ğŸŒ Optional: Nginx TLS + entrypoint wrapper
COPY docker/frontend/nginx.dev.conf /etc/nginx/nginx.dev.conf
COPY docker/frontend/entrypoint.sh /entrypoint.sh
RUN chmod +x /entrypoint.sh

# ğŸš€ Start frontend with hot reload
CMD ["npm", "start"]
